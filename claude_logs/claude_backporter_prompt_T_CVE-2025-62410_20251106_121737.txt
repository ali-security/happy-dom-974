
I need you to backport a security patch to a repository specific version - and for this version only.
You are an expert in secure coding practices and patch equivalence analysis.

REPOSITORY INFORMATION:
Repository: happy-dom
Target version for backport: 18.0.1


VULNERABILITY INFORMATION:
Vulnerability ID: CVE-2025-62410
Description: In versions before 20.0.2, it was found that --disallow-code-generation-from-strings is not sufficient for isolating untrusted JavaScript in happy-dom. The untrusted script and the rest of the application still run in the same Isolate/process, so attackers can deploy prototype pollution payloads to hijack important references like "process" in the example below, or to hijack control flow via flipping checks of undefined property. This vulnerability is due to an incomplete fix for CVE-2025-61927. The vulnerability is fixed in 20.0.2.


AFFECTED FILES:
- packages/@happy-dom/server-renderer/src/ServerRenderer.ts
- packages/@happy-dom/server-renderer/test/ServerRenderer.test.ts


THE SECURITY PATCH:
```diff
From f57dd2de5a8c2381b1a1509d288892290971f740 Mon Sep 17 00:00:00 2001
From: Seal <info@sealsecurity.io>
Date: Thu, 06 Nov 2025 10:10:38 +0000
Subject: [PATCH] CVE-2025-62410

---
 packages/@happy-dom/server-renderer/src/ServerRenderer.ts | 2 ++--
 packages/@happy-dom/server-renderer/test/ServerRenderer.test.ts | 10 ++--
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/packages/@happy-dom/server-renderer/src/ServerRenderer.ts b/packages/@happy-dom/server-renderer/src/ServerRenderer.ts
index 206ee4028..a2e406de2 100644
--- a/packages/@happy-dom/server-renderer/src/ServerRenderer.ts
+++ b/packages/@happy-dom/server-renderer/src/ServerRenderer.ts
@@ -197,7 +197,7 @@ export default class ServerRenderer {
 					return;
 				}
 				const worker = new Worker(new URL('ServerRendererWorker.js', import.meta.url), {
-					execArgv: ['--disallow-code-generation-from-strings'],
+					execArgv: ['--disallow-code-generation-from-strings', '--frozen-intrinsics'],
 					workerData: {
 						configuration: configuration
 					}
diff --git a/packages/@happy-dom/server-renderer/test/ServerRenderer.test.ts b/packages/@happy-dom/server-renderer/test/ServerRenderer.test.ts
index 6e8b9cef1..1da9b8bd3 100644
--- a/packages/@happy-dom/server-renderer/test/ServerRenderer.test.ts
+++ b/packages/@happy-dom/server-renderer/test/ServerRenderer.test.ts
@@ -58,7 +58,10 @@ describe('ServerRenderer', () => {
 					'file://' + Path.resolve(Path.join('src', 'ServerRendererWorker.js'))
 				);
 
-				expect(worker.execArgv).toEqual(['--disallow-code-generation-from-strings']);
+				expect(worker.execArgv).toEqual([
+					'--disallow-code-generation-from-strings',
+					'--frozen-intrinsics'
+				]);
 
 				expect(worker.workerData.configuration.cache.directory).toBe(
 					Path.resolve(Path.join('happy-dom', 'cache'))
@@ -216,7 +219,10 @@ describe('ServerRenderer', () => {
 					'file://' + Path.resolve(Path.join('src', 'ServerRendererWorker.js'))
 				);
 
-				expect(worker.execArgv).toEqual(['--disallow-code-generation-from-strings']);
+				expect(worker.execArgv).toEqual([
+					'--disallow-code-generation-from-strings',
+					'--frozen-intrinsics'
+				]);
 
 				expect(worker.workerData.configuration.cache.directory).toBe(
 					Path.resolve(Path.join('happy-dom', 'cache'))

```

YOUR TASK:
1. Analyze the security patch carefully to understand what vulnerability it fixes. 
2. Look at ALL files affected by the patch, including test files and build configuration. 
3. Apply the same security fix to the affected files, adapting as needed based on the older codebase. 
4. **Important**: Also backport any tests that verify the security fix. 
5. Make only the changes necessary to fix the vulnerability and validate it. 
6. Make only the changes necessary to fix THIS specific CVE. Do not fix other vulnerabilities you discover during analysis, even if similar. 
7. If code from the patch references symbols not present in the target codebase, verify the vulnerability exists before applying the fix. 
8. Don't try to modify our code to match the diff exactly. 
There can often be a significant time gap between the SECURITY PATCH and the current state of our repository. 
Function signatures and variable names may have changed — and that's perfectly okay.

   Your goal is to replicate the security outcome, not the literal code. When adapting the patch, your changes must integrate seamlessly with the target codebase. For any function you modify:
   - Understand its established patterns and conventions
   - Ensure your new code follows the same behavior contract as the existing code
   - Verify that callers of the function will still work correctly with your changes

   The security fix should blend in as if it was always part of the original code. 
9. Don't waste time modifying documentation or HTML files — focus only on the relevant code changes and their tests.
10. Make sure the changes won't break the code and that it still runs and compiles. In case it won't you will lose money.

Workflow:
1. First, examine the patch to understand what files are affected and what changes are needed.

2. For each affected file (including tests):
   a. Open the file in the repository
   b. Analyze how the patch should be applied considering the file's current state
   c. Make the necessary changes to fix the vulnerability or add test coverage
   d. Save your changes to the file

3. **CRITICAL REQUIREMENT**: If you run ANY tests, builds, or compilation commands (make, gcc, mvn, npm, dpkg-buildpackage, pytest, etc.), you MUST use a worktree. Never run builds directly in the working directory - build artifacts will pollute your patch diff.

   **Required workflow for any testing/building:**
   ```bash
   # Commit your changes to create a snapshot
   git add -A
   git commit -m "Apply security patch"

   # Create a temporary worktree for testing (detached from your commit)
   git worktree add /tmp/test-worktree HEAD

   # Run tests in the isolated worktree
   cd /tmp/test-worktree
   npm test  # or mvn test, pytest, etc.

   # Return to main worktree
   cd -

   # Clean up the test worktree
   git worktree remove /tmp/test-worktree

   # Reset the commit but keep your changes (back to uncommitted state)
   git reset --soft HEAD~1
   ```

   If tests fail, make fixes in your main working directory, amend the commit (`git commit -a --amend --no-edit`), and repeat the test process. Build artifacts stay in the temporary worktree and never affect your patch.

   Running tests/builds is optional, but if you choose to run ANY compilation or testing commands, the worktree workflow above is MANDATORY.

4. Return a JSON report of what files you modified and what changes you made

Remember:
- Focus on making minimal, targeted changes to fix the security vulnerability
- Tests that verify the fix are as important as the fix itself
- Maintain the coding style and structure of the original files
- Adapt the patch as needed for the older versions of the code

After deep analysis, if you reach the conclusion the vulnerable code doesn't exist in the target version, report this clearly rather than fixing different code.

Return your response in the following format:
```json
{{
    "cve_fixed": "CVE-xxxx-xxxx",
    "vulnerability_exists_in_target": true,
    "modified_files": [
        {{
        "path": "path/to/file1",
        "changes": "Brief description of changes made"
        }},
        {{
        "path": "path/to/file2",
        "changes": "Brief description of changes made"
        }}
    ],
    "summary": "Brief summary of the vulnerability fixed"
}}
``` or 
```json
{{
    "cve_fixed": "CVE-xxxx-xxxx",
    "vulnerability_exists_in_target": false,
    "modified_files": [],
    "summary": "The vulnerable code pattern does not exist in this version. Explanation: [describe what you looked for and why it's absent]"
}}
```
